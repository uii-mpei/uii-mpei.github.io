<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru-RU" xml:lang="ru-RU">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Лабораторная работа № 1. Инструменты диагностики сетей</title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<div id="header">
<h1 class="title">Лабораторная работа № 1. Инструменты диагностики сетей</h1>
</div>
<h1 id="цель-работы">Цель работы</h1>
<p>Требуется научиться:</p>
<ul>
<li>определять сетевые настройки машины;</li>
<li>проверять доступность удаленных узлов и маршруты до них;</li>
<li>захватывать, анализировать и сохранять сетевой трафик.</li>
</ul>
<p>Предполагается, что вы знаете:</p>
<ul>
<li>об уровнях и протоколах сетевого взаимодействия, модель OSI (лекция 1);</li>
<li>что такое IP-адрес и маска подсети, как их вычислять (СПО, ЛР по Linux);</li>
<li>что такое DNS (там же).</li>
</ul>
<p>Изученное в ходе ЛР пригодится:</p>
<ul>
<li>в учебе — для отладки программ на последующих ЛР;</li>
<li>на практике — для поиска причин и источников неполадок (troubleshooting).</li>
</ul>
<h1 id="задание">Задание</h1>
<p><strong>Примечание.</strong> В задании встречаются протоколы и инструменты, которые еще не изучались (traceroute, ICMP, UDP, TCP, DNS) — в таких местах даны краткие пояснения, а подробности будут рассмотрены на последующих занятиях.</p>
<h2 id="определение-сетевых-настроек">Определение сетевых настроек</h2>
<ol class="example" style="list-style-type: decimal">
<li><p>Просмотрите параметры сетевого подключения через GUI (графический интерфейс).</p>
<p>Для этого дважды щелкните на значке сетевого подключения (на панели уведомлений в правом нижнем углу) и на вкладке «Поддержка» нажмите кнопку «Подробности…».</p>
<p>Выделите все строки таблицы и занесите в отчет.</p>
<p>Можно наблюдать:</p>
<ul>
<li>физический адрес — адрес канального уровня (L2), он же MAC-адрес;</li>
<li>IP-адрес — адрес сетевого уровня (L3);</li>
<li>маску подсети, с помощью которой IP-адрес делится на адрес сети (префикс) и номер узла в ней;</li>
<li>основной шлюз — IP-адрес машины, через которую направляются пакеты во внешнюю сеть;</li>
<li>DHCP-сервер — IP-адрес машины, с помощью которой был получен IP-адрес данной, то есть выполнена динамическая конфигурация IP;</li>
<li>время, когда аренда получена — то есть выдан динамический IP — и когда аренда истекает — то есть понадобится снова обратиться к DHCP-серверу за новым адресом;</li>
<li>DNS-сервер — IP-адрес машины, к которой данная будет обращаться при необходимости разрешить (преобразовать) символьное имя (например, <code>mpei.ru</code>) в IP-адрес.</li>
</ul></li>
<li><p>Просмотрите параметры сетевого подключения через командную строку.</p>
<p>Для этого откройте командную строку (Пуск → Выполнить, ввести <code>cmd</code>), в ней выполните команду:</p>
<pre><code>ipconfig /all</code></pre>
<p>Саму команду и ее вывод скопируйте и занесите в отчет.</p>
<p>Раздел «Настройка протокола IP для Windows» относится ко всей машине, а не к отдельным сетевым подключениям. В частности:</p>
<ul>
<li>по имени компьютера можно обратиться к нему <em>в локальной сети</em>, однако эта возможность специфична для Windows и может быть выключена;</li>
<li>IP-маршрутизация (обычно выключена) определяет, будет ли данный узел пересылать пакеты, которые предназначены не ему.</li>
</ul>
<p>Далее следуют разделы, описывающие сетевые подключения (обычно одно). Убедитесь, что показания в таком разделе соответствуют полученным из GUI. Присутствует и настройка, через GUI невидимая: «автонастройка включена» — она означает, что в случае, когда адрес не задан статически, а DHCP-сервер недоступен, интерфейс получит специальный адрес автоматической конфигурации.</p></li>
<li><p>Проанализируйте полученные настройки.</p>
<ul>
<li>Из IP-адреса и маски подсети определите и запишите адрес сети (префикс).</li>
<li>Находится ли шлюз по умолчанию в той же сети? Если нет, то в какой?</li>
<li>Находится ли сервер DHCP в той же сети?</li>
<li>Находится ли сервер DNS в той же сети?</li>
</ul></li>
</ol>
<h2 id="ping-проверка-доступности-узлов">Ping: проверка доступности узлов</h2>
<p>Команда <code>ping</code> позволяет направить узло специальные запросы, на которые тот должен ответить, чтобы подтвердить свою доступность.</p>
<ol start="4" class="example" style="list-style-type: decimal">
<li><p>В командной строке выполните:</p>
<pre><code>ping mpei.ru</code></pre>
<p>Сделайте то же самое для других адресов:</p>
<ul>
<li>собственного IP-адреса машины (полученного в предыдущем разделе);</li>
<li>основного шлюза;</li>
<li>сервера DNS;</li>
<li><code>mos.ru</code>;</li>
<li><code>lab.facelessmen.org</code>;</li>
</ul>
<p>Из показаний <code>ping</code> сведите в таблицу: символьный адрес узла, его IP-адрес и среднее время отклика.</p></li>
<li><p>Выполните команду:</p>
<pre><code>ping mpei.ru</code></pre></li>
</ol>
<p>Как можно видеть, на запросы <code>ping</code> не получено ответов, потери 100 %. Это не означает, что узел недоступен (попробуйте зайти на сайт) — просто сервер или промежуточное устройство настроены не давать ответов на запросы, которые шлет <code>ping</code>. Это делается для безопасности: <code>ping</code> позволяет сканировать доступность узлов и сервисов на них, способен создать нагрузку на сервер.</p>
<h2 id="трассировка-маршрутов-прохождения-трафика">Трассировка маршрутов прохождения трафика</h2>
<p>Полезно бывает отследить маршрут (trace route) прохождения пакета до заданного узла. В Linux соответствующая программа называется <code>traceroute</code>, в Windows — <code>tracert</code>.</p>
<ol start="6" class="example" style="list-style-type: decimal">
<li><p>Выполните команду:</p>
<pre><code>tracert lab.facelessmen.org</code></pre>
<p>Занесите команду и ее вывод в отчет.</p></li>
</ol>
<p>Можно наблюдать два факта:</p>
<ul>
<li><p>Не для всех узлов можно получить символьное имя по IP. Если символьное имя и не нужно, у <code>tracert</code> есть ключ <code>-d</code>.</p></li>
<li><p>Не все пункты маршрута удается установить — как минимум, это узлы, настроенные не слать ответы на запросы <code>tracert</code>, а некоторые узлы блокируют и чужие ответы (как правило, на границах защищенных сетей).</p></li>
</ul>
<h2 id="разрешение-символьных-доменных-имен-в-ip-адреса">Разрешение символьных (доменных) имен в IP-адреса</h2>
<p>Как известно, пакеты направляются на адреса сетевого уровня, в типичном случае — на IP-адреса, а люди пользуются символьными именами, например, <code>mpei.ru</code>. Разрешением (resolution, т. е. преобразованием) символьных имен в адреса занимается система доменных имен (Domain Name System — DNS). Сервер DNS содержит базу соответствия имен адресам; клиент запрашивает по протоколу DNS адрес для имени, сервер отвечает ему.</p>
<ol start="7" class="example" style="list-style-type: decimal">
<li><p>Выполните команду:</p>
<pre><code>nslookup mpei.ru</code></pre>
<p>Занесите команду и ее вывод в отчет.</p></li>
</ol>
<p>«Non-authoritative answer» означает, что ответ дан не официальным сервером DNS, обслуживающим вышестоящую зону — в случае <code>mpei.ru</code>, зону <code>ru.</code> — а промежуточным сервером DNS. Это нормально. Промежуточные сервера кэшируют (запоминают) ответы вышестоящих, чтобы снизить на них нагрузку и отвечать быстрее.</p>
<p>Кэшируют ответы DNS не только сервера, но и клиенты, в том числе локальная машина. Обычно это ускоряет работу и потому удобно, но для лабораторной работы или при проблемах с DNS кэшированный ответ мешает понять, что происходит. Можно сбросить кэш специальной командой:</p>
<pre><code>ipconfig /flushdns</code></pre>
<h2 id="wireshark-захват-и-анализ-сетевого-трафика">Wireshark: захват и анализ сетевого трафика</h2>
<p>Все проходящие через машину сетевые пакеты можно захватить (capture) и пристально изучить. Это радикальный способ отладки программ, исследования протоколов и отслеживания проблем.</p>
<p>Программа <a href="http://wireshark.org">Wireshark</a> позволяет как захватить сетевой трафик, так и с удобством просмотреть его, исследовать в разных разрезах, собрать статистику.</p>
<p><strong>Примечание.</strong> В лаборатории установлена Wireshark 1.10 — последняя версия, поддерживающая Windows XP; новейшая версия Wireshark — 2.4 (на февраль 2018).</p>
<p>Исследуем, что происходит в сети при заходе на web-страницу.</p>
<h3 id="захват-пакетов">Захват пакетов</h3>
<ol start="8" class="example" style="list-style-type: decimal">
<li>Запустите Wireshark из меню «Пуск».</li>
</ol>
<p>На главной странице доступны ссылки на справку («Online» справа), список недавних файлов («Files» по центру) и главный интересующий нас раздел «Capture». По существу, в нем можно выбрать, с каких сетевых интерфейсов (например: кабельного подключения, Wi-Fi) и какие именно данные захватывать.</p>
<ol start="9" class="example" style="list-style-type: decimal">
<li><p>Откройте диалог «Capture options» и настройте захват пакетов, который относятся к заходу на web-страницу по основному сетевому интерфейсу.</p>
<ul>
<li><p>В списке интерфейсов (вверху) отметьте тот, который исследовали в начале лабораторной работы.</p></li>
<li><p>В поле «Capture filter» введите выражение:</p>
<p><code>(tcp port 80) or (udp port 53) or icmp</code></p></li>
<li><p>Не закрывайте диалог.</p></li>
</ul></li>
</ol>
<p>Смысл фильтра захвата — отобрать только запрос страницы и ответ на него с собственно страницей (<code>tcp port 80</code>), запросы и ответы DNS (<code>udp port 53</code>), а также служебные сообщения ICMP (<code>icmp</code>), появляющиеся при некоторых ошибках.</p>
<ol start="10" class="example" style="list-style-type: decimal">
<li><p>Откройте браузер. Если он уже открыт, закройте в нем все окна и вкладки, оставив единственную пустую.</p>
<p>В противном случае будут захвачены не только те пакеты, которые требуется исследовать, и придется дополнительно их фильтровать.</p></li>
<li><p>Очистите кэш браузера.</p>
<p>В лаборатории установлен Internet Explorer 8, где это делается из меню <em>Сервис → Удалить журнал обозревателя…</em> с обязательно установленной галочкой <em>Временные файлы интернета</em>.</p></li>
<li><p>Очистите кэш DNS.</p></li>
<li><p>В Wireshark запустите захват пакетов кнопкой «Start» диалога настройки захвата. Вне диалога это делалось бы кнопкой «Start capture».</p></li>
<li><p>В адресной строке браузера введите адрес:</p>
<pre><code>lab.facelessmen.org</code></pre>
<p>и нажмите выполните переход (нажмите <em>Enter</em> или кнопку).</p></li>
</ol>
<p>В Wireshark должны появится два пакета DNS (выделяются голубым) и несколько пакетов HTTP (выделяются салатовым).</p>
<ol start="15" class="example" style="list-style-type: decimal">
<li>Остановите захват пакетов красной кнопкой «Stop capture» слева вверху.</li>
</ol>
<h3 id="просмотр-пакетов">Просмотр пакетов</h3>
<p>Рабочее окно Wireshark разделено на три области (сверху-вниз):</p>
<ul>
<li><p>Список пакетов со столбцами их свойств и подсветкой в зависимости от типа.</p></li>
<li><p>Результат разбора пакета (dissection — термин Wireshark), то есть структурированное представление пакета, разобранного в соответствии с протоколами.</p></li>
<li><p>Содержимое пакета в виде байт в шестнадцатеричном виде (hex) и соответствующего им текста. Числа <code>0000</code>, <code>0010</code> и т. д. по левому краю — смещения от начала пакета в hex, то есть 0, 16 и т. д.</p></li>
</ul>
<p>Области диссекции и содержимого пакета связаны. При выборе поля или уровня диссекции подсвечиваются соответствующие байты в содержимом. И наоборот — при щелчке на байте содержимого подсвечивается элемент диссекции, к которому этот байт относится.</p>
<p>Над списком пакетов есть поле фильтра, позволяющее дополнительно отобрать захваченные пакеты. В строке состояния внизу окна отображается общее число пакетов <em>(packets)</em> и количество отображаемых из них <em>(displayed).</em> Фильтр — логическое выражение, включающее свойства пакета. Список свойств можно увидеть в диалоге «Expression…» рядом с фильтром. Обратите внимание, что [синтаксис][wireshark/filter] этого фильтра (отображения) отличается от фильтра захвата: например, вместо <code>tcp port 80</code> пишется <code>tcp.port == 80</code>.</p>
<h4 id="настройка-отображения-списка-пакетов">Настройка отображения списка пакетов</h4>
<p>В списке пакетов отображаются их основные свойства:</p>
<ul>
<li>номер пакета;</li>
<li>время прохождения (по умолчанию — в секундах от начала захвата);</li>
<li>IP-адреса источника (source) и получателя (destination);</li>
<li>протокол верхнего уровня;</li>
<li>полная длина;</li>
<li>краткая сводка (info), отражающая суть пакета.</li>
</ul>
<p>В зависимости от задачи бывает полезно видеть и другие поля. Добавим столбцы с портами и будем отображать порты в числовом виде в сводке.</p>
<ol start="16" class="example" style="list-style-type: decimal">
<li><p>В диалоге <em>Edit → Preferences…</em> выберите раздел <em>Columns</em>.</p></li>
<li><p>Добавьте столбец с портом отправителя: внизу в выпадающем списке выберите <em>Src port (unresolved)</em> и нажмите <em>Add</em>, переименуйте столбец, щелкнув по его мени в таблице. Перетащите его мышью перед столбцом <em>Protocol</em>.</p></li>
<li><p>Сделайте то же самое для порта получателя <em>Dest port (uresolved)</em>.</p></li>
<li><p>Перейдите в раздел <em>Name resolution</em> и снимите галочку <em>Resolve transport names</em>.</p></li>
<li><p>Закройте диалог кнопкой OK и убедитесь, что новые столбцы появились.</p></li>
</ol>
<p>Вид времени прохождения можно менять в меню <em>View → Time display format.</em> Нужно понимать, что у Wireshark не всегда есть информация о том, в каком часовом поясе захвачен трафик (при анализе файлов — см. ниже), поэтому отображение абсолютного времени может быть со смещением.</p>
<h3 id="исследование-пакетов">Исследование пакетов</h3>
<p>Результаты разбора сгруппированы по протоколам и упорядочены по уровням от нижнего (L2, канального) к верхнему (L7, прикладному). Внутри уровней выделены поля данных. В квадратных скобках показываются косвенные показатели, которые в пакет непосредственно не записаны.</p>
<h4 id="исследование-отдельных-пакетов-dns">Исследование отдельных пакетов (DNS)</h4>
<p>Рассмотрим пакет с ответом DNS («standard query response» в сводке). Уровни:</p>
<ul>
<li><p>Frame — условный уровень, на котором Wireshark отображает сведения об интерфейсе, с которого был захвачен пакет, с времени захвата.</p></li>
<li><p>Ethernet II — канальный уровень (L2). Его свойств немного:</p>
<ul>
<li><p>MAC-адреса отправителя <em>(Src)</em> и получателя <em>(Dst)</em>. Они показаны как 6 байт в hex (так они записаны в пакете), а также с префиксом-названием производителя оборужования, потому что диапазоны адресов приписаны к ним.</p></li>
<li><p>Протокол следующего уровня (L3) в виде кода (так записано в пакете) и по названию (из справочника).</p></li>
</ul></li>
<li><p>Internet Protocol Version 4 — сетевой уровень (L3), пакет IPv4. Среди его свойств есть IP-адрес отправителя <em>(Src)</em> и получателя <em>(Dst)</em>. Можно убедиться, что они совпадают с собственным адресом машины и адресом сервера DNS, установленного в начале ЛР.</p></li>
<li><p>User Datagram Protocol — транспортный уровень (L4). На этом уровне определяется, какому приложению предназначен пакет, по номерам портов: отправителя <em>(Src port)</em> по получателя <em>(Dst port)</em>. В данном случае пакет отправлен сервером DNS, который работает на порту 53, а получен клиентом DNS на порту со случайным большим номером.</p></li>
<li><p>Domain Name System (response) — прикладной уровень (L7). Собственно сообщение-ответ на запрос, какой IP у <code>lab.facelessmen.org</code>. Стоит отметить:</p>
<ul>
<li><p>поле <em>[Request In: …]</em> — ссылку на пакет с запросом, к которому относится рассматриваемый ответ;</p></li>
<li><p>поле <em>Transaction ID</em>, одинаковое в запросе и ответе, чтобы клиент мог отправить несколько запросов, а затем связать ответы с ними — фактически это поле играет роль сеансового (L5) уровня, хотя отдельного протокола под это не выделено.</p></li>
</ul></li>
</ul>
<ol start="21" class="example" style="list-style-type: decimal">
<li><p>В области разбора пакета выделите последовательно L2, L3, L4, L7 и проследите в области содержимого пакета, что они расположены последовательно — это и есть инкапсуляция уровней.</p></li>
<li><p>В области содержимого пакета выберите несколько байт, чтобы увидеть, каким полям и каких уровней они соответствуют.</p></li>
</ol>
<p>При исследованиях трафика, особенно сообща с другими специалистами, бывает полезно добавить к пакетам текстовые комментарии. Для этого нужно использовать пункт <em>Packet comment…</em> контекстного меню пакета в списке.</p>
<ol start="23" class="example" style="list-style-type: decimal">
<li>Добавьте к рассматриваемому пакету комментарий «<code>look at me</code>».</li>
</ol>
<p>По комментариям можно пакеты искать (фильтровать):</p>
<ul>
<li>фильтр <code>pkt_comment</code> или <code>frame.comment</code> выбирает все пакеты с комментариями;</li>
<li>фильтр <code>frame.comment contains &quot;look&quot;</code> выбирает пакеты, комментарий к которым содержит подстроку <code>look</code>.</li>
</ul>
<h4 id="исследование-сеансов-http">Исследование сеансов (HTTP)</h4>
<ol start="24" class="example" style="list-style-type: decimal">
<li>Введите фильтр отображения: <code>http || dns || icmp</code>.</li>
</ol>
<p>Хотя он одинаков по сути с фильтром захвата, но сообщает Wireshark, что нас интересуют не просто пакеты через порт 80 по протоколу TCP, а именно сообщения HTTP (они же, но на уровне L7). В результате количество пакетов в списке сократилось: остались только несущие сообщения, а служебные скрыты.</p>
<ol start="25" class="example" style="list-style-type: decimal">
<li>Щелкнув по любому пакету HTTP (салатовому) правой кнопкой мыши, выберите в контекстном меню <em>Follow TCP stream</em> (проследить сеанс).</li>
</ol>
<p>В открывшемся окне показаны данные, переданные клиентом серверу (подсвечены красным) и от сервера клиенту (подсвечены синим). Как можно наблюдать:</p>
<ul>
<li><p>Протокол имеет текстовый формат. Для случаев, когда это не так, имеется возможность переключить просмотр в режим отображения байт <em>(Hex Dump)</em>.</p></li>
<li><p>Помимо непосредственно текста страницы передается немало служебных данных.</p></li>
</ul>
<ol start="26" class="example" style="list-style-type: decimal">
<li>Закройте окно слежения за сеансом.</li>
</ol>
<p>Обратите внимание, что фильтр отображения изменился на <code>tcp.stream eq 0</code>: число в конце (<code>0</code> в примере) — порядковый номер сеанса из всех захваченных. Соответственно, пропала фильтрация только пакетов с сообщениями HTTP. Если просмотреть пакеты, в большинстве нет данных выше <em>Transmission Control Protocol</em> (TCP) — это служебные пакеты L4+L5, нужные для установления, поддержки и завершения сеанса. Они будут рассмотрены на последующих ЛР.</p>
<ol start="27" class="example" style="list-style-type: decimal">
<li><p>Верните предыдущий фильтр отображения.</p>
<p>Они сохраняются в выпадающем списке поля фильтра. После выбора нужно применить фильтр, нажав <em>Enter</em> или кнопку <em>Apply.</em></p></li>
</ol>
<h3 id="анализ-трафика">Анализ трафика</h3>
<p>Иногда отдельные пакеты не представляют большого интереса, зато можно сделать выводы по статистике трафика. Опробуем важнейшие средства из меню <em>Statistics</em>. В каждом пункте нужно открыть соответствующий диалог и ознакомиться с его содержимым и возможностями.</p>
<ol start="28" class="example" style="list-style-type: decimal">
<li><p><em>Protocol Hierarchy</em> — сводка, какие протоколы и насколько часто встречаются в захваченном трафике. Позволяет сразу обнаружить сетевую активность, которой быть не должно, или наоборот.</p></li>
<li><p><em>Conversations</em> — сеансы в широком смысле, то есть не только L5, но и обмены данными, например, по протоколу DNS.</p></li>
<li><p><em>Endpoints</em> — уникальные адреса и порты участников.</p></li>
<li><p><em>Packet Lengths</em> — гистограмма распределения длин пакетов. Полезна для выявления аномальной активности или для оптимизации настроек сетевого ПО и аппаратуры.</p></li>
<li><p><em>IO Graph</em> — график пакетов или байт в секунду. Полезен для анализа нагрузки и обнаружения времени атак. Сохраните его как рисунок <code>lab01-tools-iograph.png</code>.</p></li>
<li><p><em>Flow Graph…</em> — диаграмма последовательности переданных пакетов. Постройте ее для отображаемых пакетов <em>(Displayed packets)</em> всех видов <em>(General flow)</em> с отображением сетевых адресов <em>(Network source/destination addresses)</em>. Сохраните результат в текстовый файл <code>lab01-tools-flowgraph.txt</code>.</p></li>
</ol>
<h3 id="сохранение-данных">Сохранение данных</h3>
<p>Далеко не всегда пакеты захватываются в Wireshark, сразу же анализируются и забываются. Гораздо чаще захват происходит:</p>
<ul>
<li>в то время, когда наблюдается интересующий трафик;</li>
<li>на той машине (устройстве), где это возможно;</li>
<li>не обязательно Wireshark (<code>tcpdump</code>, встроенными средствами оборудования).</li>
</ul>
<p>Анализ же выполняется отдельно, иногда не одним человеком и по несколько раз. Очевидно, для этого нужно сохранять захваченные пакеты в файл, чтобы передавать его и анализировать трафик offline.</p>
<ol start="34" class="example" style="list-style-type: decimal">
<li>Выберите пункт меню <em>File → Save</em> и сохраните запись трафика в файл <code>lab01-tools.pcapng</code>.</li>
</ol>
<p>Здесь необходимо обратить внимание на формат файла:</p>
<ul>
<li><p><em>Wireshark/… <code>*.pcapng</code></em> — современный формат Wireshark: позволяет сохранять комментарии к пакетам, расширяем в будущем, однако не поддерживается многими небольшими <a href="https://wiki.wireshark.org/Tools">утилитами</a> для обработки записей трафика.</p></li>
<li><p><em>Wireshark/tcpdump/… <code>*.pcap</code></em> — классический формат. Не вполне универсален и не расширяем, зато поддерживается всеми средствами обработки записей.</p></li>
<li><p>То же с «nanosecond precision» — времена прохождения пакетов записываются с точностью до наносекунд, что бывает нужно на быстрых интерфейсах.</p></li>
</ul>
<p>Wireshark позволяет открыть файл в одном формате и сохранить в другом.</p>
<p>В аналогичном диалоге <em>File → Export specified packets…</em> можно выбрать, какие пакеты сохранять: все, отображаемые или с выбранными номерами.</p>
<ol start="35" class="example" style="list-style-type: decimal">
<li>Убедитесь, что файл сохранился, и закройте Wireshark. Выберите файл в «Проводнике» и откройте его в Wireshark.</li>
</ol>
<p>Иногда нужно экспортировать не пакеты, а результаты их разбора, то есть, по сути, область списка пакетов, область разбора пакета или обе сразу. Для этого применяется пункты меню из группы <em>File → Export packet dissections</em>: можно экспортировать данные как в текстовом виде для чтения <em>(…as “Plain Text” file)</em>, так и в структурированных видах.</p>
<p>В открывшемся диалоге можно выбрать, что сохранять:</p>
<ul>
<li><em>packet summary</em> — строку из списка пакетов;</li>
<li><em>packet details</em> — результат разбора в текстовом виде;</li>
<li><em>packet bytes</em> — содержимое пакета как байты в шестнадцатеричном виде.</li>
</ul>
<ol start="36" class="example" style="list-style-type: decimal">
<li>Сохраните только список пакетов как текстовый файл <code>lab01-tools-export.txt</code>.</li>
</ol>
<p>На сайте Wireshark есть познавательный <a href="http://wiki.wireshark.org/SampleCaptures">сборник</a> записей трафика разных протоколов.</p>
<h1 id="контрольные-вопросы">Контрольные вопросы</h1>
<p><strong>Примечание.</strong> Во всех вопросах «привести пример» означат открыть запись трафика в Wireshark и продемонстрировать требуемое.</p>
<ol>
<li><p>Может ли быть настроен IP-адрес, но не настроен шлюз по умолчанию? Если да, к чему это приведет; если нет, почему?</p></li>
<li><p>Может ли быть настроен IP-адрес, но не выбран сервер DHCP? Если да, в каком случае и на что это повлияет; если нет, почему?</p></li>
<li><p>Может ли быть настроен IP-адрес, но не настроен сервер DNS? Если да, к чему это приведет; если нет, почему?</p></li>
<li><p>Если не настроено статического адреса и не работает DHCP, получит ли интерфейс адрес (при настройках, наблюдавшихся в ЛР), и если да, какой?</p></li>
<li><p>Можно ли с компьютера под управлением Windows с помощью <code>ping</code> проверить доступность компьютера под управленим Linux? А наоборот?</p></li>
<li><p>Верно ли, что если не приходят ответы на <code>ping</code>, сервер недоступен по сети? Если да, приведите пример из ЛР; если нет, в каком случае?</p></li>
<li><p>Может ли IP-адрес не иметь доменных имен? А наоборот?</p></li>
<li><p>Можно ли настройкой машины с IP-адресом добиться, чтобы этот адрес нельзя было найти по доменному имени? Если да, в каком случае; если нет, почему?</p></li>
<li><p>Возможно ли по IP-адресу узнать его доменные имена?</p></li>
<li><p>Можно ли с помощью Wireshark перехватить трафик, идущий непосредственно между двумя другими машинами (без удаленного доступа к этим машинам)?</p></li>
<li><p>Как с помощью Wireshark захватить трафик и через кабель, и через Wi-Fi?</p></li>
<li><p>Как в Wireshark ограничить перечень захватываемых пакетов? Приведите пример <em>не</em> из ЛР.</p></li>
<li><p>Как в Wireshark отфильтровать захваченные пакеты? Приведите пример <em>не</em> из ЛР.</p></li>
<li><p>Исследователю нужно проанализировать задержки между пакетами, то есть время, прошедшее между появлением соседних захваченных пакетов. Как быстро получить в Wireshark эти сведения?</p></li>
<li><p>Как в Wireshark просмотреть, представление интересующего поля протокола в содержимом пакета (в виде байт)? Продемонстрируйте на примере.</p></li>
<li><p>Как в Wireshark определить, к какому полю и какого протокола относится произвольбый байт в содержимом пакета? Продемонстрируйте на примере.</p></li>
<li><p>Как в Wireshark, имея захваченный трафик, найти IP-адреса всех участников и отфильтровать только пакеты, связанные с определенным адресом?</p></li>
<li><p>Как в Wireshark, имея захваченный трафик, найти все сеансы TCP в нем и отфильтровать только пакеты, участвующие в одном из них?</p></li>
<li><p>Администратору известно, что в трафике его сервера в основном HTTP, некоторый объем DNS и на порядок меньше ICMP, чем DNS. Как в Wireshark, захватив этот трафик, быстро проверить, что соотношения протоколов в норме?</p></li>
<li><p>Требуется проанализировать запись трафика, содержащую начало DDoS-атаки, при которой трафика внезапно стало на порядок больше нормы. Как в Wireshark быстро найти момент начала атаки? (Запись начинается раньше.)</p></li>
<li><p>Администратору известно, что в нормальном трафике размеры пакетов в основном менее 400 байт, хотя иногда встречаются и больше (до 1500 байт). При конкретной атаке направляется много пакетов длиной около 1000 байт. Как в Wireshark быстро проверить, была ли атака за время записи?</p></li>
<li><p>В каких случаях имеет смысл сохранять захваченные пакеты в <code>*.pcap</code>, а в каких — в <code>.pcapng</code>? Что делать, если нужен файл <code>*.pcap</code>, а имеется <code>*.pcapng</code>?</p></li>
</ol>
<h1 id="литература">Литература</h1>
<ul>
<li><a href="http://www.howtogeek.com/104278/">Введение в Wireshark</a> (англ.), похожее на этот документ.</li>
<li>Статья «<a href="http://linkmeup.ru/blog/115.html">Wireshark — приручение акулы</a>» проекта LinkMeUp.</li>
<li><a href="https://uii.bitbucket.io/study/courses/int/wireshark/">Wireshark: краткое руководство</a> — отдельное пособие по Wireshark прошлых лет, для новой версии и с иллюстрациями.</li>
</ul>
</body>
</html>
